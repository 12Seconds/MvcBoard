@using MvcBoard.Models.Community;
@model MvcBoard.Models.Community.BoardViewModel;
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    var BoardTitle = "전체 게시판"; // Category 값에 따라 변경 필요 (Controller 에서 변경된 상태로 넘겨주거나)

    ViewData["Title"] = BoardTitle;
}

<div class="community">

    <aside class="community_aside_left">

        <div class="user_info">
            <button class="login">로그인/회원가입</button>
        </div>

        <a asp-area="" asp-controller="Community" asp-action="Index">
            <div class="category_list_item selected">
                @* 그냥 긁어와도 되나 *@
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="18" height="18" rx="9" fill="#333333"></rect><path d="M5.25 5.66602H12.75V6.49935H5.25V5.66602ZM5.25 8.58268H12.75V9.41602H5.25V8.58268ZM5.25 11.4993H12.75V12.3327H5.25V11.4993Z" fill="white"></path></svg>
                &nbsp;전체 게시판
            </div>
        </a>
        <a asp-area="" asp-controller="Community" asp-action="Hot">
            <div class="category_list_item">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="18" height="18" rx="9" fill="#333333"></rect><path d="M10.8752 5.25C12.141 5.25 13.1668 6.29167 13.1668 7.75C13.1668 10.6667 10.0418 12.3333 9.00016 12.9583C7.9585 12.3333 4.8335 10.6667 4.8335 7.75C4.8335 6.29167 5.87516 5.25 7.12516 5.25C7.90016 5.25 8.5835 5.66667 9.00016 6.08333C9.41683 5.66667 10.1002 5.25 10.8752 5.25Z" fill="white"></path></svg>
                &nbsp;인기 게시판
            </div>
        </a>
        <a asp-area="" asp-controller="Community" asp-action="Notice">
            <div class="category_list_item">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="18" height="18" rx="9" fill="#333333"></rect><path d="M11.5002 5.25V6.08333H11.0835V8.58333L11.9168 9.83333V10.6667H9.41683V13.5833H8.5835V10.6667H6.0835V9.83333L6.91683 8.58333V6.08333H6.50016V5.25H11.5002Z" fill="white"></path></svg>
                &nbsp;공지 게시판
            </div>
        </a>
        <a asp-area="" asp-controller="Community" asp-action="Index" asp-route-category="1">
            <div class="category_list_item">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="18" height="18" rx="9" fill="#333333"></rect><path d="M5.25 5.66602H12.75V6.49935H5.25V5.66602ZM5.25 8.58268H12.75V9.41602H5.25V8.58268ZM5.25 11.4993H12.75V12.3327H5.25V11.4993Z" fill="white"></path></svg>
                &nbsp;자유 게시판(임시)
            </div>
        </a>
        
    </aside>

    <div class="community_main">
        <h3>@BoardTitle</h3>
        <hr/>

        <div class="rating_filter">실시간 주간 월간</div>

        <div class="rated_scroll_board"></div>

        <a asp-area="" asp-controller="Community" asp-action="write">
            <div class="write_button"> 새 글을 작성해보세요 </div>
        </a>

        <div class="board_label">전체</div> @* TODO 필터 (장터 게시판) *@

        @* 게시판 영역 *@
        <div class="board">

            <div class="item labels">
                <div class="category">게시판</div>
                <div class="title">제목</div>
                <div class="writer">작성자</div>
                <div class="date">날짜</div>
                <div class="views">조회수</div>
            </div>
           
            @foreach (var item in Model.PostListData)
            {
                <div class="item post">
                    <div class="category">자유 게시판</div> @*TODO Category 에 따라 *@
                    <div class="title">
                        <a asp-area="" asp-controller="Community" asp-action="View" 
                            asp-route-postId="@item.PostId"
                            asp-route-page=@Model.Page
                            asp-route-category=@Model.Category
                            asp-route-commentPage=@null
                        >@item.Title @item.PostId</a> @* TODO 임시 postId 지울 것 *@
                    </div> @* 클릭 시 페이지 이동 처리 필요*@
                    <div class="writer">@item.UserName</div>
                    <div class="date">@(item.CreateDate.ToString("yyyy.MM.dd"))</div> @* 7일 전 처리 필요 *@
                    <div class="views">@item.Views</div>
                </div>
            }
        </div> 

        @* 페이지 인디케이터 영역 *@
        @{
            // TODO 가능하면 간소화 필요 --> 마지막 페이지 쯤에서 5개 노출 안되는 문제 있음, offset 조절 필요
            int page = Model.Page ?? 1;
            int first_center_index = BoardViewModel.DisplayPageCount / 2 + 1;
            int start = Math.Max(page - (BoardViewModel.DisplayPageCount - 1) / 2, 1);
            int offset = (first_center_index > page) ? first_center_index - page : 0;
            int end = Math.Min(page + offset + (BoardViewModel.DisplayPageCount - 1) / 2, Model.PageCount); // TODO PageCount 도 DisplayPageCount 처럼 상수로 바꿀것

            Console.WriteLine($"####### page: {page}, offset: {offset}, start: {start}, end: {end}, display: {BoardViewModel.DisplayPageCount}");

            if (Model.PostListData.Count > 0)
            {
                <div class="page_indicator">
                    <a asp-area="" asp-controller="Community" asp-action="Index" asp-route-category=@Model.Category asp-route-page=1>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="20" height="20" rx="10" fill="#C4C4C4"></rect><path d="M9.99999 9.33317L14.6115 6.25867C14.6491 6.23362 14.6929 6.21924 14.738 6.21708C14.7832 6.21492 14.8281 6.22505 14.868 6.2464C14.9079 6.26774 14.9412 6.2995 14.9644 6.33829C14.9877 6.37708 15 6.42145 15 6.46667V13.5327C15 13.5779 14.9877 13.6223 14.9644 13.661C14.9412 13.6998 14.9079 13.7316 14.868 13.7529C14.8281 13.7743 14.7832 13.7844 14.738 13.7823C14.6929 13.7801 14.6491 13.7657 14.6115 13.7407L9.99999 10.6662V13.5327C9.99997 13.5779 9.98768 13.6223 9.96443 13.661C9.94119 13.6998 9.90786 13.7316 9.86799 13.7529C9.82812 13.7743 9.78321 13.7844 9.73804 13.7823C9.69287 13.7801 9.64914 13.7657 9.61149 13.7407L4.31199 10.2077C4.27775 10.1848 4.24968 10.1539 4.23026 10.1176C4.21084 10.0813 4.20068 10.0408 4.20068 9.99967C4.20068 9.95851 4.21084 9.918 4.23026 9.88171C4.24968 9.84543 4.27775 9.8145 4.31199 9.79167L9.61149 6.25867C9.64914 6.23362 9.69287 6.21924 9.73804 6.21708C9.78321 6.21492 9.82812 6.22505 9.86799 6.2464C9.90786 6.26774 9.94119 6.2995 9.96443 6.33829C9.98768 6.37708 9.99997 6.42145 9.99999 6.46667V9.33317Z" fill="white"></path></svg>
                        처음
                    </a>
                    @* TODO 이전 페이지 버튼 *@

                    @for (var i = start; i <= end; i++)
                    {
                        <a class=@(i == Model.Page ? "selected" : "") asp-area="" asp-controller="Community" asp-action="Index" asp-route-category=@Model.Category asp-route-page=@i >@i</a> 
                    }

                    @* TODO 다음 페이지 버튼 *@
                    <a asp-area="" asp-controller="Community" asp-action="Index" asp-route-category=@Model.Category asp-route-page=@Model.PageCount>
                        마지막
                        <svg style="transform: rotate(180deg)" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="20" height="20" rx="10" fill="#C4C4C4"></rect><path d="M9.99999 9.33317L14.6115 6.25867C14.6491 6.23362 14.6929 6.21924 14.738 6.21708C14.7832 6.21492 14.8281 6.22505 14.868 6.2464C14.9079 6.26774 14.9412 6.2995 14.9644 6.33829C14.9877 6.37708 15 6.42145 15 6.46667V13.5327C15 13.5779 14.9877 13.6223 14.9644 13.661C14.9412 13.6998 14.9079 13.7316 14.868 13.7529C14.8281 13.7743 14.7832 13.7844 14.738 13.7823C14.6929 13.7801 14.6491 13.7657 14.6115 13.7407L9.99999 10.6662V13.5327C9.99997 13.5779 9.98768 13.6223 9.96443 13.661C9.94119 13.6998 9.90786 13.7316 9.86799 13.7529C9.82812 13.7743 9.78321 13.7844 9.73804 13.7823C9.69287 13.7801 9.64914 13.7657 9.61149 13.7407L4.31199 10.2077C4.27775 10.1848 4.24968 10.1539 4.23026 10.1176C4.21084 10.0813 4.20068 10.0408 4.20068 9.99967C4.20068 9.95851 4.21084 9.918 4.23026 9.88171C4.24968 9.84543 4.27775 9.8145 4.31199 9.79167L9.61149 6.25867C9.64914 6.23362 9.69287 6.21924 9.73804 6.21708C9.78321 6.21492 9.82812 6.22505 9.86799 6.2464C9.90786 6.26774 9.94119 6.2995 9.96443 6.33829C9.98768 6.37708 9.99997 6.42145 9.99999 6.46667V9.33317Z" fill="white"></path></svg>
                    </a>
                </div>
            }
        }
        
    </div>

    <aside class="community_aside_right">
        광고 배너 영역
    </aside>
    
</div>
